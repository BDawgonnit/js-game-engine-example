<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>utilities.mjs - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Entity.html">Entity</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Entity.html#getComponent">getComponent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Entity.html#hasComponent">hasComponent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Entity.html#removeComponent">removeComponent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Entity.html#setComponent">setComponent</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="GameEngine.html">GameEngine</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GameEngine.html#changeScene">changeScene</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GameEngine.html#fetchAssets">fetchAssets</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GameEngine.html#getScene">getScene</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GameEngine.html#hasScene">hasScene</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GameEngine.html#queueAsset">queueAsset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GameEngine.html#queueAssets">queueAssets</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GameEngine.html#removeScene">removeScene</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GameEngine.html#run">run</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GameEngine.html#setScene">setScene</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GameEngine.html#stopGame">stopGame</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="GameEvent.html">GameEvent</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="module-Game-Game.html">Game</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="module-InputManager-InputManager.html">InputManager</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Scene.html">Scene</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scene.html#addEntity">addEntity</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scene.html#changeScene">changeScene</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scene.html#getEntities">getEntities</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scene.html#getSystem">getSystem</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scene.html#hasEntity">hasEntity</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scene.html#hasSystem">hasSystem</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scene.html#reindexEntity">reindexEntity</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scene.html#removeEntity">removeEntity</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scene.html#removeSystem">removeSystem</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scene.html#setEntityIndexer">setEntityIndexer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scene.html#setSystem">setSystem</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scene.html#stopGame">stopGame</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Scene.html#update">update</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="System.html">System</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="System.html#changeScene">changeScene</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="System.html#stopGame">stopGame</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="System.html#update">update</a></span></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Game.html">Game</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-InputManager.html">InputManager</a></span></li><li class="nav-heading">Mixins</li><li class="nav-heading"><span class="nav-item-type type-mixin">M</span><span class="nav-item-name"><a href="eventTargetMixin.html">eventTargetMixin</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createArray">createArray</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">utilities.mjs</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const ADD_PROPS_METHOD_NAME = 'construct'

// Creates a function that "extracts" an object with only the properties that test true
const createExtractObjFunc = test => obj => {
	const extractedObj = {}
	Object.entries(obj).forEach(([key, val]) => {
		if (test(val, key)) extractedObj[key] = val
	})
	return extractedObj
}

// Extracts an object with only the non-function properties
const extractConstructor = createExtractObjFunc((val, key) => key === ADD_PROPS_METHOD_NAME)

// Extracts an object with only the function properties (methods)
const extractMethods = createExtractObjFunc((val, key) => key !== ADD_PROPS_METHOD_NAME)

// Creates an extendable class that includes the provided mixins
const createMixinFunc = (Clazz) => (...mixins) => {
	const constructors = mixins.map(mixin => extractConstructor(mixin).construct)
	const methodsMixins = mixins.map(mixin => extractMethods(mixin))

	// Add properties to class constructor
	let Mixable
	if (Clazz)
		Mixable = class extends Clazz {
			constructor(...args) {
				super(...args)
				constructors.forEach(construct => construct.call(this))
			}
		}
	else
		Mixable = class {
			constructor() {
				constructors.forEach(construct => construct.call(this))
			}
		}

	// Add methods to class prototype
	Object.assign(Mixable.prototype, ...methodsMixins)

	return Mixable
}

const MixedWith = createMixinFunc()

const unindexItem = (map, item) => {
	map.forEach((indexer, key) => {
		map.get(key).delete(item)
	})
}

/**
 * createArray function.
 *
 * Creates nested empty arrays
 *
 * @param { ...number } args - Nested array lengths
 * @returns { array } - An array of arrays
 */
const createArray = (...args) => {
	if (args.length === 0) return []

	const length = args[0]

	const arr = new Array(length)

	let i = length
	if (args.length > 1) {
		while(i--) arr[length-1 - i] = createArray(...(args.slice(1)))
	}

	return arr
}


// TODO: Pull this out into its own file
const _IndexedSet = new WeakMap()
class IndexedSet extends Set {
	constructor() {
		super()
		_IndexedSet.set(this, {
			indexed: new Map(),
			indexers: new Map(),
		})
	}

	// subset filter
	setIndex(indexName, indexer) {
		const _this = _IndexedSet.get(this)

		if (this.size > 0) {
			throw new Error('Must add indexes before adding items')
		}
		_this.indexers.set(indexName, indexer)
		_this.indexed.set(indexName, new Set())
		return this
	}

	// get subset
	getIndexed(indexName) {
		return _IndexedSet.get(this).indexed.get(indexName)
	}

	// Can be called from observing logic (like a Proxy)
	// or events (like if a component property changes)
	reindexItem(item) {
		const _this = _IndexedSet.get(this)
		unindexItem(_this.indexed, item) // in case item was already added
		_this.indexers.forEach((indexer, key) => {
			if (indexer(item)) _this.indexed.get(key).add(item)
		})
		return this
	}

	add(item) {
		const returnVal = super.add(item)
		this.reindexItem(item)
		return returnVal
	}

	delete(item) {
		const _this = _IndexedSet.get(this)
		unindexItem(_this.indexed, item)
		return super.delete(item)
	}
}


export { createMixinFunc, createArray, MixedWith, IndexedSet }
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Mar 04 2018 17:40:33 GMT-0500 (Eastern Standard Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
